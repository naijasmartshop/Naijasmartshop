<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>SmartShop</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="https://fonts.googleapis.com/css?family=Montserrat:400,700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: Montserrat, Arial, sans-serif;
            background: linear-gradient(135deg, #f0eee7 0%, #eff8ed 100%);
            color: #222;
            margin: 0;
        }
        header {
            background: #12770c;
            color: white;
            padding: 35px 20px 23px 20px;
            text-align: center;
            box-shadow: 0 3px 16px #0001;
            border-radius: 0 0 25px 25px;
        }
        header h1 {
            font-weight: 700;
            letter-spacing: 1.5px;
            margin-bottom: 10px;
            font-size: 2em;
        }
        .market-table {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
            gap: 27px;
            margin: 40px auto 140px auto;
            max-width: 1200px;
            width: 96%;
        }
        .phone-card {
            border: 1.5px solid #e3f6e3;
            padding: 19px 15px 18px 15px;
            border-radius: 18px;
            background: #fff;
            box-shadow: 0 10px 28px #12770c09, 0 2px 4px #b2e7b777;
            transition: box-shadow 0.18s;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-width: 0;
        }
        .phone-card:hover {
            box-shadow: 0 15px 32px #12770c1c, 0 3px 8px #b2e7b799;
            transform: translateY(-3px) scale(1.03);
            border-color: #fbaa16;
        }
        .phone-card img {
            width: 95%;
            max-width: 210px;
            height: 150px;
            object-fit: contain;
            border-radius: 13px;
            margin-bottom: 16px;
            box-shadow: 0 2px 14px #2222;
            background: #eee;
        }
        .phone-brand {
            font-weight: 700;
            font-size: 1.15em;
            margin: 5px 0 3px 0;
            color: #12770c;
            text-align: center;
        }
        .phone-model {
            font-weight: 500;
            font-size: 1em;
            margin-bottom:7px;
            color: #222;
            text-align:center;
        }
        .phone-price {
            color: #12770c;
            font-size: 1.23em;
            background: linear-gradient(90deg,#fffbe9,#ffe9ae);
            padding: 7px 24px;
            border-radius: 14px;
            margin: 14px 0 0 0;
            font-weight: bold;
            letter-spacing: 1px;
            box-shadow: 0 1px 5px #ffd06036;
        }
        .buy-btn {
            background: #fbaa16;
            color: white;
            padding: 12px 0;
            border: none;
            border-radius: 8px;
            margin-top: 15px;
            cursor: pointer;
            font-weight: 700;
            font-size: 1.1em;
            transition: background 0.2s;
            box-shadow: 0 2px 10px #fbaa1640;
            width: 100%;
            min-width: 0;
            max-width: 320px;
            display: block;
        }
        .buy-btn:hover {
            background: #12770c;
        }
        .qty-badge {
            margin-top: 8px;
            font-size: 0.95em;
            color: #444;
            background: #f3fff3;
            padding: 6px 10px;
            border-radius: 14px;
            border: 1px solid #e0f6e0;
            width: fit-content;
        }

        /* Floating round cart icon */
        .cart-icon {
            position: fixed;
            right: 18px;
            bottom: 18px;
            width: 64px;
            height: 64px;
            border-radius: 50%;
            background: linear-gradient(180deg,#fbaa16,#ff9f00);
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 6px 24px rgba(18,119,12,0.22);
            cursor: pointer;
            z-index: 60;
            transition: transform 0.12s;
            border: 3px solid rgba(255,255,255,0.6);
        }
        .cart-icon:active { transform: scale(0.98); }
        .cart-icon svg { width:28px; height:28px; color:#fff; filter: drop-shadow(0 2px 6px #0003); }
        .cart-badge {
            position: absolute;
            top: -6px;
            right: -6px;
            min-width: 22px;
            height: 22px;
            padding: 0 6px;
            background: #12770c;
            color: #fff;
            border-radius: 999px;
            font-weight: 700;
            font-size: 0.78em;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 2px 6px #0002;
        }

        /* Modal / Drawer for cart */
        .cart-modal-backdrop {
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.4);
            display: none;
            z-index: 70;
            align-items: flex-end; /* bottom sheet */
            justify-content: center;
        }
        .cart-modal {
            width: 100%;
            max-width: 720px;
            border-radius: 16px 16px 0 0;
            background: linear-gradient(180deg,#fff,#fbfffb);
            padding: 18px;
            box-shadow: 0 -8px 40px rgba(0,0,0,0.25);
            transform: translateY(100%);
            transition: transform 200ms ease;
            max-height: 80vh;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }
        .cart-modal.show {
            transform: translateY(0%);
        }
        .cart-modal .header {
            display:flex;
            justify-content:space-between;
            align-items:center;
            gap:10px;
            margin-bottom:8px;
        }
        .cart-modal .items {
            overflow:auto;
            padding-right:6px;
            margin-bottom:10px;
        }
        .cart-modal .footer {
            display:flex;
            gap:10px;
            align-items:center;
            justify-content:space-between;
            margin-top:8px;
        }
        .cart-modal .close-btn {
            background: transparent;
            border: none;
            font-size: 1.1em;
            cursor: pointer;
            color: #666;
        }
        .cart-item {
            display:flex;
            align-items:center;
            gap:10px;
            margin-bottom:8px;
            font-size:0.98em;
            border-bottom:1px dashed #eef7ee;
            padding-bottom:8px;
        }
        .cart-item .controls {
            display:flex;
            align-items:center;
            gap:6px;
        }
        .cart-item button.qty-btn {
            background:#12770c;
            color:white;
            border:none;
            border-radius:6px;
            width:32px;
            height:32px;
            cursor:pointer;
            font-weight:700;
        }
        .cart-item .qty {
            min-width:28px;
            text-align:center;
            font-weight:700;
            color:#12770c;
            background:#fffbe9;
            border-radius:6px;
            padding:6px 10px;
            box-shadow:0 1px 4px #ffd06036;
        }
        .cart-item .item-price {
            margin-left:8px;
            color:#333;
            font-weight:600;
        }
        .cart-total {
            font-size: 1.18em;
            font-weight: 800;
            color: #12770c;
        }
        .cart-checkout-btn {
            padding: 12px 18px;
            background: #fbaa16;
            color: #fff;
            border: none;
            border-radius: 10px;
            font-size: 1.05em;
            font-weight: 700;
            box-shadow: 0 2px 10px #fbaa1640;
            cursor: pointer;
        }
        .cart-checkout-btn:active,
        .cart-checkout-btn:hover {
            background: #12770c;
        }

        @media (max-width:900px) {
            header h1 { font-size: 1.43em;}
            .market-table { margin: 30px 2vw 140px 2vw; gap: 15px;}
        }
        @media (max-width:640px) {
            .market-table { grid-template-columns: repeat(auto-fit, minmax(85vw,1fr)); gap:13px; }
            .phone-card { min-width: 0; }
            header {padding-bottom: 22px;}
            .cart-modal { border-radius: 12px 12px 0 0; }
        }
        @media (max-width:430px) {
            .phone-card img{max-width:99vw;height:115px;}
            .phone-card{padding:13px 4vw;}
            .market-table{grid-template-columns:1fr;}
            header{font-size:0.95em;}
        }
    </style>
</head>
<body>
    <header>
        <h1>Buy Your Smartphone at NaijaSmartShop!</h1>
        <p>
            <span>iPhone • Samsung • Infinix • Tecno • Xiaomi • Oppo</span>
            <br>
            <span style="font-size:1.09em;">
                <b>All for ₦10,000 - ₦20,000</b>
            </span>
        </p>
    </header>

    <div class="market-table" id="market-table"></div>

    <!-- Floating Cart Icon -->
    <div class="cart-icon" id="cart-icon" role="button" aria-label="Open cart" tabindex="0">
        <svg viewBox="0 0 24 24" fill="none" aria-hidden="true" focusable="false" xmlns="http://www.w3.org/2000/svg">
            <path d="M6 6h14l-1.4 7H8.2L6 6z" fill="currentColor" opacity="0.95"/>
            <circle cx="10.5" cy="19.5" r="1.5" fill="#fff"/>
            <circle cx="17.5" cy="19.5" r="1.5" fill="#fff"/>
        </svg>
        <div class="cart-badge" id="cart-badge" aria-hidden="true">0</div>
    </div>

    <!-- Cart Modal / Bottom sheet -->
    <div class="cart-modal-backdrop" id="cart-backdrop" aria-hidden="true">
        <div class="cart-modal" role="dialog" aria-modal="true" aria-labelledby="cart-title" id="cart-modal">
            <div class="header">
                <div>
                    <div id="cart-title"><strong>Your Cart</strong></div>
                    <div id="cart-summary" style="font-size:0.92em;color:#556;">0 items</div>
                </div>
                <div style="display:flex;align-items:center;gap:8px;">
                    <div class="cart-total" id="cart-total">₦0</div>
                    <button class="close-btn" id="cart-close" aria-label="Close cart">✕</button>
                </div>
            </div>

            <div class="items" id="cart-items"></div>

            <div class="footer">
                <div style="font-weight:700;color:#333;">Total: <span class="cart-total" id="cart-total-footer">₦0</span></div>
                <div style="display:flex;gap:8px;align-items:center;">
                    <button class="cart-checkout-btn" id="cart-checkout">Checkout</button>
                </div>
            </div>
        </div>
    </div>

    <script>
    // Product list (5 models per brand)
    const phoneModels = [
        // iPhone
        { brand: "iPhone", model: "iPhone 13 Pro", price: 19000, img: "" },
        { brand: "iPhone", model: "iPhone 12", price: 18000, img: "" },
        { brand: "iPhone", model: "iPhone SE 2022", price: 14000, img: "" },
        { brand: "iPhone", model: "iPhone XR", price: 13000, img: "" },
        { brand: "iPhone", model: "iPhone 11", price: 15000, img: "" },
        // Samsung
        { brand: "Samsung", model: "Galaxy S21 Ultra", price: 20000, img: "" },
        { brand: "Samsung", model: "Galaxy S20 FE", price: 17000, img: "" },
        { brand: "Samsung", model: "Galaxy Note 20", price: 17000, img: "" },
        { brand: "Samsung", model: "Galaxy A52", price: 13500, img: "" },
        { brand: "Samsung", model: "Galaxy S10", price: 12000, img: "" },
        // Infinix
        { brand: "Infinix", model: "Infinix Note 12", price: 11000, img: "" },
        { brand: "Infinix", model: "Infinix Hot 10", price: 10000, img: "" },
        { brand: "Infinix", model: "Infinix Smart 7", price: 12000, img: "" },
        { brand: "Infinix", model: "Infinix S5", price: 10500, img: "" },
        { brand: "Infinix", model: "Infinix Zero 8", price: 13500, img: "" },
        // Tecno
        { brand: "Tecno", model: "Tecno Camon 19", price: 11500, img: "" },
        { brand: "Tecno", model: "Tecno Spark 10", price: 11000, img: "" },
        { brand: "Tecno", model: "Tecno Pop 6 Go", price: 10000, img: "" },
        { brand: "Tecno", model: "Tecno Pova Neo", price: 10500, img: "" },
        { brand: "Tecno", model: "Tecno Camon 15", price: 10900, img: "" },
        // Xiaomi
        { brand: "Xiaomi", model: "Redmi Note 10 Pro", price: 18000, img: "" },
        { brand: "Xiaomi", model: "Redmi Note 9", price: 14500, img: "" },
        { brand: "Xiaomi", model: "Redmi 10C", price: 10500, img: "" },
        { brand: "Xiaomi", model: "Poco X3 NFC", price: 12000, img: "" },
        { brand: "Xiaomi", model: "Redmi 9A", price: 10000, img: "" },
        // Oppo
        { brand: "Oppo", model: "Oppo Reno 8", price: 14000, img: "" },
        { brand: "Oppo", model: "Oppo A74", price: 12000, img: "" },
        { brand: "Oppo", model: "Oppo F19 Pro+", price: 12500, img: "" },
        { brand: "Oppo", model: "Oppo A55", price: 11000, img: "" },
        { brand: "Oppo", model: "Oppo Find X2", price: 15000, img: "" }
    ];

    const marketTable = document.getElementById('market-table');

    // cart is an array of { brand, model, price, img, qty }
    let cart = [];

    // Render product cards
    phoneModels.forEach((ph, idx) => {
        const div = document.createElement('div');
        div.className = "phone-card";
        div.innerHTML = `
            <img src="${ph.img}" alt="${ph.brand} ${ph.model}">
            <div class="phone-brand">${ph.brand}</div>
            <div class="phone-model">${ph.model}</div>
            <div class="phone-price">₦${ph.price.toLocaleString()}</div>
            <button class="buy-btn" onclick="addToCart(${idx})">Add to Cart</button>
            <div class="qty-badge" id="qty-${idx}">Qty in cart: 0</div>
        `;
        marketTable.appendChild(div);
    });

    // Elements for cart UI
    const cartIcon = document.getElementById('cart-icon');
    const cartBadge = document.getElementById('cart-badge');
    const cartBackdrop = document.getElementById('cart-backdrop');
    const cartModal = document.getElementById('cart-modal');
    const cartItemsContainer = document.getElementById('cart-items');
    const cartTotalEl = document.getElementById('cart-total');
    const cartTotalFooterEl = document.getElementById('cart-total-footer');
    const cartSummary = document.getElementById('cart-summary');
    const cartCloseBtn = document.getElementById('cart-close');
    const cartCheckoutBtn = document.getElementById('cart-checkout');

    // Load cart from sessionStorage if available
    function loadCartFromStorage() {
        try {
            const stored = sessionStorage.getItem('cart');
            if (stored) {
                const parsed = JSON.parse(stored);
                cart = parsed.map(it => ({
                    brand: it.brand,
                    model: it.model,
                    price: Number(it.price),
                    img: it.img || "",
                    qty: Number(it.qty) || 1
                }));
            }
        } catch (e) {
            console.warn("Failed to parse stored cart:", e);
            cart = [];
        }
    }

    loadCartFromStorage();

    // Update UI and storage
    function updateCart() {
        // update total
        let total = cart.reduce((sum, item) => sum + item.price * item.qty, 0);
        cartTotalEl.textContent = "₦" + total.toLocaleString();
        cartTotalFooterEl.textContent = "₦" + total.toLocaleString();

        // badge count (sum of quantities)
        const count = cart.reduce((s, it) => s + it.qty, 0);
        cartBadge.textContent = count;
        cartBadge.setAttribute('aria-hidden', count === 0 ? 'true' : 'false');
        cartBadge.style.display = count > 0 ? 'flex' : 'none';

        // render cart items in modal
        cartItemsContainer.innerHTML = "";
        if (!cart.length) {
            cartItemsContainer.innerHTML = `<div style="padding:12px;color:#556;">Your cart is empty.</div>`;
            cartSummary.textContent = "0 items";
        } else {
            cart.forEach((item, i) => {
                const row = document.createElement('div');
                row.className = "cart-item";
                row.innerHTML = `
                    <div style="flex:1;">
                        <div style="font-weight:700;">${item.brand} ${item.model}</div>
                        <div class="item-price">₦${(item.price).toLocaleString()} each • Subtotal: ₦${(item.price * item.qty).toLocaleString()}</div>
                    </div>
                    <div class="controls">
                        <button class="qty-btn" aria-label="decrease" onclick="changeQty(${i}, -1)">−</button>
                        <div class="qty" id="cart-qty-${i}">${item.qty}</div>
                        <button class="qty-btn" aria-label="increase" onclick="changeQty(${i}, 1)">+</button>
                    </div>
                `;
                cartItemsContainer.appendChild(row);
            });
            cartSummary.textContent = `${cart.reduce((s, it) => s + it.qty, 0)} items`;
        }

        // update qty badges on product cards
        phoneModels.forEach((ph, idx) => {
            const badge = document.getElementById(`qty-${idx}`);
            if (!badge) return;
            const found = cart.find(c => c.brand === ph.brand && c.model === ph.model);
            badge.textContent = found ? `Qty in cart: ${found.qty}` : "Qty in cart: 0";
        });

        // persist to sessionStorage
        sessionStorage.setItem('cart', JSON.stringify(cart));
        sessionStorage.setItem('cart-total', total);
    }

    // Add to cart (increments qty if already present)
    function addToCart(idx) {
        const ph = phoneModels[idx];
        const existingIndex = cart.findIndex(c => c.brand === ph.brand && c.model === ph.model);
        if (existingIndex > -1) {
            cart[existingIndex].qty += 1;
        } else {
            cart.push({
                brand: ph.brand,
                model: ph.model,
                price: ph.price,
                img: ph.img || "",
                qty: 1
            });
        }
        updateCart();
        // briefly highlight the cart icon to show feedback
        cartIcon.animate([{ transform: 'scale(1)' }, { transform: 'scale(1.08)' }, { transform: 'scale(1)' }], { duration: 220 });
    }

    // Change quantity (delta: +1 or -1)
    function changeQty(cartIndex, delta) {
        if (cartIndex < 0 || cartIndex >= cart.length) return;
        cart[cartIndex].qty += delta;
        if (cart[cartIndex].qty <= 0) {
            // remove item
            cart.splice(cartIndex, 1);
        }
        updateCart();
    }

    // Open / close modal
    function openCartModal() {
        cartBackdrop.style.display = 'flex';
        // allow animation frame then show
        requestAnimationFrame(() => {
            cartModal.classList.add('show');
            cartBackdrop.setAttribute('aria-hidden', 'false');
        });
    }
    function closeCartModal() {
        cartModal.classList.remove('show');
        cartBackdrop.setAttribute('aria-hidden', 'true');
        // wait for transition then hide backdrop
        setTimeout(() => { cartBackdrop.style.display = 'none'; }, 220);
    }

    // Checkout action
    function checkout() {
        if (!cart.length) { alert("Your cart is empty."); return; }
        // For demo: save then navigate
        sessionStorage.setItem('cart', JSON.stringify(cart));
        window.location.href = "checkout.html";
    }

    // Wire up UI controls
    cartIcon.addEventListener('click', () => {
        updateCart(); // ensure up-to-date
        openCartModal();
    });
    cartIcon.addEventListener('keydown', (e) => {
        if (e.key === 'Enter' || e.key === ' ') {
            e.preventDefault();
            updateCart();
            openCartModal();
        }
    });
    cartBackdrop.addEventListener('click', (e) => {
        // close if clicking outside the modal content
        if (e.target === cartBackdrop) closeCartModal();
    });
    cartCloseBtn.addEventListener('click', closeCartModal);
    cartCheckoutBtn.addEventListener('click', () => { checkout(); });

    // expose changeQty and addToCart to global scope (used by inline onclicks)
    window.changeQty = changeQty;
    window.addToCart = addToCart;
    window.checkout = checkout;

    // initial render
    updateCart();
    </script>
</body>
</html>
